---
layout: default
title: Create ROIs
parent: Data exploration
grand_parent: umIToolbox app
permalink: /documentation/tutorials/tt_creating_rois.html
---
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Create ROIs</title>
  </head>
  <body>
    <h2>Create Regions of interest</h2>
    <hr>
    <p>
      In this tutorial, you will learn how to create regions of interest (ROIs) from imaging data. ROIs are frequently used in imaging projects to delimit areas of interest such as anatomical landmarks or brain functional modules identified by neuronal activation such as in the example used in our tutorial on <a href="./tt_creating_event_triggered_avg_maps.html"> creating event-triggered maps</a>.
    </p>
    <p>
      The <b><i>umIToolbox</i></b> has a dedicated app that creates, edits and
      manages ROIs called <i>ROImanager</i>. The app was briefly introduced in the tutorial on <a href="./tt_align_sessions.html">recording alignment</a> where it was used to create an <i>Imaging Reference Frame</i> file. There, we showed how to create a new <i>reference point</i>, how to set the image's <i>pixel size</i> and how to create a <i>logical mask</i>. These steps won't be covered here. For further details on the <i>ROImanager</i>, please refer to the app's <a href="../userDocs/apps/ROImanager.html">documentation</a>. In this tutorial, we will focus on the different ways to create ROIs and how to save them for later use on the toolbox.
    </p>
    <h3>Sections</h3>
    <hr>
    <ul>
      <li><a href="#basic-roi-creation">Basic ROI creation</a>: create ROIs by drawing polygons and selecting single pixels.</li>
      <li><a href="#allen-atlas">Use preset ROIs for mouse cortex</a>: create ROIs to delimit areas from the mouse cortex using the <i>Allen Brain Atlas</i>.</li>
      <li><a href="#roi-by-threshold">Create ROIs by thresholding</a>: create ROIs based on pixel values of an image.</li>
      <li><a href="#save-rois">Saving ROIs</a>: save the ROIs to a file to use them later in the toolbox.</li>
    </ul>
    <h3 id="basic-roi-creation">Basic ROI creation</h3>
    <hr>
    <p>
      In the examples below, we show how to create a polygonal ROI and a <i>Point</i> ROI. Here, we already opened a frame from a recording in <i>ROImanager</i> app and set the <i>reference point</i>, <i>pixel size</i>, <i>colormap</i> and <i>logical mask</i>.
    </p>
    <h4>Polygonal ROIs</h4>
    <p>
      To create a polygonal ROI:
      <ol>
        <li>Go to <i>Create &gt;&gt; Polygon </i></li>
        <li>Enter the name of the new ROI.</li>
        <li>Draw the polygon.</li>
        <li>Once the drawing is finished, one can edit the shape by adding/deleting vertices or translating the polygon across the image.</li>
        <li>Finally, double-click inside the ROI to save.</li>
      </ol>
    </p>
    <p align="center">
      <video src="../assets/gifs/roimanager_create_new_poly_roi.ogg" alt="roimanager_create_new_poly_roi" width = "660" controls></video>
    </p>
    <p align="center"><i>How to draw a new polygonal ROI</i></p>
    <h4>Point ROIs (single-pixel)</h4>
    <p>
      Point ROIs are simply ROIs consisted of a single pixel from the image. This type of ROI does not allow any type of editing. Thus, if you want to change the location of the ROI, you can simply create a new point with the same name of the one that you want to change.
    </p>
    <p>
      There are two ways to create a point ROI: interactively or using the X,Y coordinates.
    </p>
    <p>
      To create an ROI for a single pixel (interactively):
      <ol>
        <li>Go to <i>Create &gt;&gt; Point </i></li>
        <li>Enter the name of the new ROI.</li>
        <li>Click on <i>Interactively</i>.</li>
        <li>Double-click to select the pixel.</li>
      </ol>
    </p>

    <p align="center">
      <video src="../assets/gifs/roimanager_create_new_pt_roi_interactive.ogg" alt="roimanager_create_new_pt_roi_interactive" width="660" controls></video>
    </p>
    <p align="center"><i>How to select (interactively) a single pixel as ROI</i></p>
    <p>
      Alternatively, you can select a pixel by it's X,Y coordinates as so:
      <ol>
        <li>Go to <i>Create &gt;&gt; Point </i></li>
        <li>Enter the name of the new ROI.</li>
        <li>Click on <i>Type Coordinates</i>.</li>
        <li>Type the X and Y coordinates and click <i>Ok</i>.</li>
      </ol>
      *In the example below, we use Matlab's datatip tool <img src="../assets/img/tt_dataviewer_datatip_icon.png" alt="tt_dataviewer_datatip_icon"> just to show the X and Y coordinates of the pixel to be selected.
    </p>
    <p align="center">
      <video src="../assets/gifs/roimanager_create_new_pt_roi_XYcoords.ogg" alt="roimanager_create_new_pt_roi_XYcoords" width="660" controls></video>
    </p>
    <p align="center"><i>How to select (using X,Y coordinates) a single pixel as ROI</i></p>

    <h3 id="allen-atlas">Use preset ROIs for mouse cortex</h3>
    <hr>
    <p>
      The <i>ROImanager</i> app provides a preset ROI mask composed by the top view of the  <i>Mouse Allen Brain Atlas</i>:
    </p>
    <p align="center">
      <img src="../assets/img/roimanager_mouse-areas.png" alt="roimanager_mouse-areas.png" width="660">
    </p>
    <p align="center"><i>Preset ROIs from the Mouse Allen Brain Atlas showing the Bregma estimated position.</i></p>

    <div class="warnnote">
      <p><strong>Important</strong><br>
        The position of the Bregma is provided here as a rough estimate. The data from the Mouse Brain atlas does not provide any anatomical landmark coordinates from the mouse skull. For more info on this, see this <a href="https://community.brain-map.org/t/why-doesnt-the-3d-mouse-brain-atlas-have-bregma-coordinates/158">discussion</a> from the Allen Brain Map Community Forum.
      </p>
    </div>
    <div class="tipnote">
      <p><strong>Tip</strong><br>
         For a more accurate result, it is advisable to set <i>Bregma</i> as the image’s reference point and to set the image’s <i>pixel size</i> before applying the ROIs from the Mouse Brain Atlas. Once these parameters are set, the ROI mask will be automatically place the mask’s estimated Bregma position over the reference point and resize it to approximate the mask’s real size.
       </p>
    </div>
    <p>
      Here is how to apply the ROIs from the Mouse Allen Brain Atlas:
      <ol>
        <li>Go to <i>Create &gt;&gt; Mouse Allen Brain Atlas &gt;&gt; Areas &gt;&gt; Select.</i></li>
        <li>Select the Regions using the "Select" tab (All regions are selected by default).</li>
        <li>Close the ROI table window.</li>
        <li>The ROI mask will be resized to match the image's pixel size and it will be automatically translated so the estimated Bregma is put over the reference point.</li>
        <li>Optionally, you can interactively adjust the ROI mask position and shape to fit the image landmarks.</li>
        <li>Double-click inside the ROI mask to apply.</li>
      </ol>
    </p>
    <p align="center">
      <video src="../assets/gifs/roimanager_apply_Allen_rois.ogg" alt="roimanager_apply_Allen_rois" width = "660" controls></video>
    </p>
    <p align="center"><i>How to use the Mouse Allen Brain Atlas to generate ROIs</i></p>
    <div class="infonote">
      <p><strong>Note</strong><br>
        In the example above, the ROIs that overlayed with the logical mask are redrawn to remove the areas outside the cortex.
      </p>
    </div>
    <p>
      This example shows how to create the full surface of all cortical areas from the Mouse Allen Brain Atlas. The <i>ROImanager</i> offers the option to customize the size of the ROIs and to generate only the regions' centroids. For further details, please refer to the app's <a href="../userDocs/apps/ROImanager.html">documentation</a>.
    </p>

    <h3 id="roi-by-threshold">Create ROIs by thresholding</h3>
    <hr>
    <p>
      Another way to create ROIs is to use the image's pixel values to select a region with values above or below a threshold. This feature is particularly useful to delimit regions based on the amplitude of a signal. For instance, you can create ROIs to select a region of the cortex activated by a sensory stimulation. In the example below, we show how to create an ROI to select the cortical area activated after a whisker stimulation in a mouse expressing <i>GCaMP6</i>.
    </p>
    <div class="tipnote">
      <p><strong>Tip</strong><br>
        When creating ROIs by threshold, it is useful to work with the <i>ROImanager</i> app as a add-on from the <i>DataViewer</i> app because you can use the <i>DataViewer</i> to easily navigate through the recording to find the best frames to be thresholded. This is the case of the example below.
      </p>
    </div>
    <p>
      The data used in this example is an image time series that was preprocessed and split by trials to show the normalized response amplitude (&Delta;F/F) to a vibro-tactile stimulation of the left whiskers. The data was loaded in <i>DataViewer</i> to show the average of 10 trials. The colormap and color scale were adjusted to better visualize the activated region.
    </p>
    <p>
      Here is a snapshot of the input data:
    </p>
    <img src="../assets/img/roimanager_thresholdapp_data_overview.png" alt="roimanager_thresholdapp_data_overview" width = "880">
    <p>
      The first thing to do is to navigate through the data to find the frame to be thresholded. Here, we will select the frame with the peak response (around 800 ms after the stimulation):
    </p>
    <img src="../assets/img/roimanager_thresholdapp_data_overview2.png" alt="roimanager_thresholdapp_data_overview2" width="880">
    <p>
      To launch the thresholding tool:
    </p>
    <ol>
      <li>Go to <i>Add-ons &gt;&gt; ROImanager</i> to open the <i>ROImanager</i> app.</li>
      <li>In the <i>ROImanager</i> app, go to <i>Create &gt;&gt; From threshold...</i>.</li>
    </ol>
    <p>
      Below is an overview of the thresholding tool. The main GUI contains the control options to create the ROIs and the <i>Image window</i> shows the selected frame on the left in grayscale and on the right, a binary image showing the ROIs. For further details on how to use the app, read the documentation of the <a href="../userDocs/apps/ROImanager.html">ROImanager</a> app.
    </p>
    <p align="center">
    <img src="../assets/img/roimanager_roimask_creator_overview.png"  alt="roimanager_roimask_creator_overview" width = "660">
    </p>
    <p align="center"><i>Overview of the ROIMask Creator app</i></p>
    <p>
      You can use the slider in the main GUI to interactively set the threshold:
    </p>
    <video src="../assets/gifs/roimanager_roimask_creator_interactive_thr_set.ogg" alt="roimanager_roimask_creator_interactive_thr_set" width = "660" controls></video>
    <p>
      Or, you can set the exact threshold value in the <i>threshold level</i> edit field in the main GUI.<br>
      Now, to select the region activate by the whisker stimulation, we will set the following parameters:
    </p>
    <ul>
      <li> Set the threshold to <b>0.03</b>.</li>
      <li> Exclude ROIs with less than <b>4</b> pixels.</li>
      <li> Check the <b>Smooth borders</b> options.</li>
    </ul>
    <p>
      Here is the preview of the ROI with the abovementioned parameters set:
    </p>
    <img src="../assets/img/roimanager_roimask_creator_roi_preview.png" alt="roimanager_roimask_creator_roi_preview" width = "660">
    <p>
      Finally, click on <i>Create ROIs</i> to generate the ROI based on the thresholded image. The ROI will be created and listed in the <i>ROImanager</i> app with a generic name (<i>newROI_1</i>):
    </p>
    <img src="../assets/img/roimanager_roimask_creator_resultROI.png" alt="roimanager_roimask_creator_resultROI" width = "660">
    <p>
      To change the name of the ROI, click on the ROI name listed in the table in <i>ROImanager</i>, type the new name and press Enter:
    </p>
    <video src="../assets/gifs/roimanager_changeROI_name.ogg" alt="roimanager_changeROI_name" width="440" controls></video>
    <h3 id="save-rois">Saving ROIs</h3>
    <hr>
    <p>
      After creating the ROIs, you can save the ROIs to a <samp>ROImasks_&lt;NAME&gt;.mat</samp> file. The file will contain all the statistical measurements shown in the <i>ROImanager</i> table and the individual ROI masks. As you will see in the following tutorials, the ROI files will be used to extract and aggregate the data from each ROI.
    </p>
    <p>
      In the <i>ROImanager</i> app:<br>
      To save the current ROIs to a new file:
    </p>
    <ol>
      <li>Go to <i>File Save as...</i>.</li>
      <li>Type the file name (default = ROImasks_data.mat)</li>
      <li>Click on <i>Save</i></li>
      <li>Select a folder to save the ROI file (see note below!)</li>
    </ol>
    <div class="infonote">
      <p><strong>Note</strong><br>
        This note concerns users of the main GUI (not <i>DataViewer</i> as standalone)!<br>
        If the <i>ROImanager</i> app was called from the toolbox main GUI (<samp>umIToolbox</samp>) the ROI file will automatically be saved in the subject's save folder. However, if the app was opened as an <i>Add-on</i> from <i>DataViewer</i> you should manually select the subject's folder to save the ROI file in. It advisable to save the ROI file inside the subject's save directory because some of the toolbox functions using the ROI file will look for it there!
      </p>
    </div>
  </body>
</html>
