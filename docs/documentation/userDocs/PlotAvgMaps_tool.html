<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../css/master.css">
    <style media="screen">
      ul {
        line-height: 1.5;
      }
    </style>
    <title>PlotAvgMaps tool</title>
  </head>
  <body>
    <h2>Plot average maps tool</h2>
    <hr>
    <p>
      This tool is part of the <i>Analysis</i> tab from the <a href="umIToolbox.html"><samp>umIToolbox</samp></a> app. It displays the group average of activation maps (with dimensions Y,X) for each acquisition and observation.
    </p>
    <p>
      To use the tool, first, select the <b>recordings</b>, <b>files</b> and <b>observations</b> (e.g. ROIs) to be displayed. Then, launch the tool by clicking on <i>Plot Average Maps</i> button in the <i>Apps & tools</i> panel.
    </p>

    <h3 id="input-data">Input data and preprocessing best practice</h3>
    <hr>
    <p>
      This tool accepts only data with dimensions Y,X,O(bservation) stored in <samp>.mat</samp> files. This kind of data is generated by some of the <a href="../user_doc_index.html"><i>Analysis</i></a> functions such as the <a href="genCorrelationMatrix.html"><samp>genCorrelationMatrix</samp></a> function. Please refer to these functions for more details.
    </p>
    <p>
      In order to average the maps of different subjects , This tool uses the coordinates of a reference point (e.g. the <i>Bregma</i> position on the mouse skull) as well as the pixel size of the image to perform a <b>translation</b> and <b>scaling</b> of the activation maps (<b>rotation is not performed here!)</b>). This information is stored on the data files under the variables <samp>refPt</samp> and <samp>pxPemm</samp>, respectively. Currently, only imaging data that was preprocessed using either the <a href="alignFrames.html">automatic</a> or <a href="manual_image_registration_tool.html">manual</a> alignment options contain this information.
    </p>
    <div class="tipnote">
      <p><strong>Tip</strong><br>
        This tool does not perform any rotation to the images. Thus, it is advisable to process the alignment (preprocessing step) using a reference frame in a consistent position. For instance, for mouse cortical imaging data, be sure to vertically align <i>Bregma</i> and <i>Lambda</i> landmarks before creating the <i>Imaging Reference Frame</i>.
      </p>
      <p>
        Please, read the documentation of the <a href="ROImanager.html"><samp>ROImanager</samp></a> app and the tutorials on <a href="../tutorials/tt_align_sessions.html">how to align imaging datasets</a> for details on how to edit and create <i>Imaging Reference Frames</i>.
      </p>
    </div>

    <h3 id="the-interface">The interface</h3>
    <hr>
    <p style="text-align: center;">
      <img src="../assets/img/PlotAvgMaps_fig1.png" alt="PlotAvgMaps_fig1" width="660"><br>
      <i>Main interface components</i>
    </p>
    <h4 id="1-main-window">1. Main window</h4>
    <ul>
      <li>Options panel &gt;&gt;
        <ul>
          <li>
            <b><i>Use logical masks</i></b>: Check this box to use logical masks from the <i>Imaging Reference Files</i> of each recording to exclude unwanted regions before averaging. A dialog window will open prior to the averaging of the data to select the Imaging reference <samp>.mat</samp> file.
            <div class="warnnote">
              <p><strong>Important</strong><br>
                This tool will look for the logical masks in the <i>Imaging Reference Files</i> located in the subject folder. In order to make this work, all subject folders must contain an Imaging Reference <samp>.mat</samp> file with an existing logical mask. The <samp>.mat</samp> file must have the same name.
              </p>
            </div>
          </li>
          <li>Data type &gt;&gt (currently disabled)
            <ul>
              <li><b><i>Linear</i></b>: majority of cases</li>
              <li><b><i>Angular</i></b>: Special case where the imaging data values express angles. Common examples are the phase maps of retinotopy datasets</li>
            </ul>
          </li>
          <li><b><i>Spatial Filter sigma</i></b>: Standard deviation value for a spatial gaussian filter applied to the averaged data. If <b>zero</b>, no filter is applied</li>
          <li><b><i>Set colormap</i></b>: Sets the colormap and scale of the plots</li>
          <li>color scale &gt;&gt;
            <ul>
              <li><b><i>Auto</i></b>: The colormap is scaled for each <i>Image window</i>. This means that the colormap limits correspond to the <b>min</b> and <b>max</b> values of the observation (<b>data from all groups included!</b>)</li>
              <li><b><i>Uniform</i></b>: One scale is applied to all <i>Image windows</i>. If this option is used, the color scale limits can be manually set in the <i>Set colormap</i> option</li>
            </ul>
          </li>
          <li><b><i>Create Maps</i></b> button: Click here to calculate the average maps and plot the data</li>
          <li><b><i>Export</i></b> button: exports the figures to an image file (.PNG, .JPEG or .TIFF)</li>
        </ul>
      </li>
    </ul>

    <h4 id="2-image-window">2. Image window</h4>
    <p> One figure (image window) is created for each observation contained in the input data. A montage of the average maps is shown for each group where the maps are displayed in chronological order (from left to right). A montage is created for each experimental group.
    </p>

  </body>
</html>
