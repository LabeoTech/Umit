<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../css/master.css">
    <style media="screen">
      ul {
        line-height: 1.5;
      }
    </style>
    <title>MergeRec tool</title>
  </head>
  <body>
    <h2>Merge recording tool</h2>
    <hr>
    <p>
      This tool is a part of the <a href="./umIToolbox.html"><samp>umIToolbox</samp></a> app. It allows the concatenation of two or more recordings in the time domain or as trials.
    </p>
    <h3 id="limitations">Limitations</h3>
    <hr>
    <p>
      This tool accepts only imaging data that have the same frame size (i.e. same Y,X dimension sizes). For the concatenationa as trials, the size of the time dimension of the first recording will be the size of each trial. It is assumed that all recordings have the same number of frames or the difference is negligible.
    </p>
    <h3 id="procedure">Procedure</h3>
    <hr>
    <h4 id="1-launch-the-tool">1. Launch the tool</h4>
    <p>
      First of all, open the <samp>umIToolbox</samp> app and load a project file. Once the file is loaded, go to <i>Utilities &gt;&gt; Merge Recordings</i> to launch the tool. The list of objects from the <samp>umIToolbox</samp> app will appear in the tool. Thus, you can optionally filter the object tree before opening the tool.
    </p>
    <h4 id="2-Select the objects">2. Select the objects</h4>
    <p>
      Select the objects containing the recordings in the object tree (left). Here, you can select several acquisitions from one or more subjects. The recordings will be merged across different acquisitions from one subject at a time.
    </p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig1.png" alt="MergeRec_fig1" width="660">
    </p>
    <h4 id="3-select-the-acquisitions">3. Select the acquisitions</h4>
    <p>
      Once the objects are selected, the acquisitions are listed in the "Choose acquisitions" list box. If two or more subjects are selected, only the acquisitions that exist in all subjects will appear in this list. Highlight the acquisitions containing the data to be merged.
    </p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig2.png" alt="MergeRec_fig2" width="660">
    </p>
    <h4 id="4-select-the-modality">4. Select the modality</h4>
    <p>
      Now, select the modality containing the recording to be merged. Here, only one modality will be allowed to be selected.
    </p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig3.png" alt="MergeRec_fig3" width="660">
    </p>
    <h4 id="5-select-the-file">5. Select the file</h4>
    <p>
      Here, all files that exist in the selected modality folder of all selected acquisitions will be displayed. Select the file to be merged and click on the "Select" button.
    </p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig4.png" alt="MergeRec_fig4" width="660">
    </p>
    <h4 id="6-reorder-data">6. Reorder the data</h4>
    <p>
      Once the "Select" button is pushed, a panel will appear with the options to merge the data. In the "Set order" list box, click on the individual acquisition names and use the arrows to reorder the list. <i>The data will be merged in the top-down order of the list.</i>
    </p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig5.png" alt="MergeRec_fig5" width="660">
    </p>
    <h4 id="7-select-merge-type">7. Select merge type</h4>
    <p> Select the type of merge in the <i>merge type</i> panel.</p>
    <p>
      This tool provides two types of merge: <b>movie</b> or <b>trial</b>. The <b>movie</b> type consists of the concatenation of the data in the time domain. Whereas the <b>trial</b> type considers the data as trials and concatenate them in the Event dimension. For instance, for image time series with dimensions Y,X,T concatenated as trials, the resulting file will have the dimensions E,Y,X,T where the length of <b>E</b> is the number of files.
    </p>
    <h4 id="8-events">8. Events</h4>
    <p>
      In the <i>Events</i> panel, you can check the box <i>Overwrite event IDs</i> to add identifiers to mark the frames from the original acquisitions in the merged file. Sometimes this information is necessary for the analysis. For instance, in the example depicted here, the recordings must have a specific identifier encoding the direction of a visual stimulus. Write the new indentifiers separated by ";".
    </p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig6.png" alt="MergeRec_fig6" width="660">
    </p>
    <div class="infonote">
      <p><strong>Note</strong><br>
        If there are triggers already stored in the data's meta data file, they will be automatically concatenated. In this case, to preserve this information, leave the box unchecked.
      </p>
    </div>
    <div class="infonote">
      <p><strong>Note</strong><br>
        A new <samp>events.mat</samp> file will be created when:
        <ol>
          <li>The concatenated data contains triggers. In this case, the new <samp>events.mat</samp> file will contain the trigger info from the data's meta data file.</li>
          <li>All folders with the recordings to be concatenated contain an <samp>event.mat</samp> file and the concatenated data does <b>not</b> contain triggers. In this case, the info from all <samp>events.mat</samp> files will be merged into a single one.</li>
        </ol>
      </p>
    </div>
    <h4 id="9-id-new-data">9. Identify the new acquisition and file</h4>
    <p>
      Type the name of the acquisition that will contain the merged file. If the acquisition already exists, the merged file will be stored in the modality folder inside it. Then, type the name of the merged file.
    </p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig6b.png" alt="MergeRec_fig6b" width="660">
    </p>
    <h4 id="10-merge-data">10. Merge the file</h4>
    <p>
      Finally, click on the <i>Merge Data</i> button to merge the data. This tool uses the <samp>mergeRecordings.m</samp> function to execute the merging.
    </p>
    <p>Once finished, either close the tool or go back to merge another file. Once the tool is closed the project file is automatically saved and the object tree is updated.</p>
    <p style="text-align: center">
      <img src="../assets/img/MergeRec_fig7.png" alt="MergeRec_fig7" width="660">
    </p>
    <hr>
  </body>
</html>
