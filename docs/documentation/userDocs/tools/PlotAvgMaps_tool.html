---
permalink: /documentation/userDocs/tools/PlotAvgMaps_tool.html
layout: default
title: Plot Average Maps
parent: Tools
grand_parent: Documentation
nav_order: 7
---
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <style media="screen">
      ul {
        line-height: 1.5;
      }
    </style>
    <title>PlotAvgMaps tool</title>
  </head>
  <body>
    <h2>Plot average maps tool</h2>
    <hr>
    <p>
      This tool is part of the <i>Analysis</i> tab from the <a href="../apps/umIToolbox.html"><samp>umIToolbox</samp></a> app. It displays the group average of activation maps (with dimensions Y,X) for each acquisition and observation.
    </p>
    <p>
      To use the tool, first, select the <b>recordings</b>, <b>files</b> and <b>observations</b> (e.g. ROIs) to be displayed. Then, launch the tool by clicking on <i>Plot Average Maps</i> button in the <i>Apps & tools</i> panel.
    </p>

    <h3 id="input-data">Input data and preprocessing best practice</h3>
    <hr>
    <p>
      This tool accepts <b>maps</b> data types (i.e. data with dimensions (E),Y,X,O) stored in <samp>.mat</samp> files. This kind of data is generated by some of the <a href="../fcns.html"><i>Analysis</i></a> functions such as the <a href="../fcns/genCorrelationMatrix.html"><samp>genCorrelationMatrix</samp></a> function. Please refer to these functions for more details.
    </p>
    <p>
      In order to average the maps of different subjects , This tool uses the coordinates of a reference point (e.g. the <i>Bregma</i> position on the mouse skull) as well as the pixel size of the image to perform a <b>translation</b> and <b>scaling</b> of the activation maps (<b>rotation is not performed here!)</b>). This information is stored on the data files under the variables <samp>refPt</samp> and <samp>pxPemm</samp>, respectively. Currently, only imaging data that was preprocessed using either the <a href="../fcns/alignFrames.html">automatic</a> or <a href="manual_image_registration_tool.html">manual</a> alignment options contain this information.
    </p>
    <div class="tipnote">
      <p><strong>Tip</strong><br>
        This tool does not perform any rotation to the images. Thus, it is advisable to process the alignment (preprocessing step) using a reference frame in a consistent position. For instance, for mouse cortical imaging data, be sure to vertically align <i>Bregma</i> and <i>Lambda</i> landmarks before creating the <i>Imaging Reference Frame</i>.
      </p>
      <p>
        Please, read the documentation of the <a href="../apps/ROImanager.html"><samp>ROImanager</samp></a> app and the tutorials on <a href="../../tutorials/tt_align_sessions.html">how to align imaging datasets</a> for details on how to edit and create <i>Imaging Reference Frames</i>.
      </p>
    </div>

    <h3 id="the-interface">The interface</h3>
    <hr>
    <p style="text-align: center;">
      <img src="../../assets/img/PlotAvgMaps_fig1.png" alt="PlotAvgMaps_fig1" width="660"><br>
      <i>Interface components</i>
    </p>
    <h4 id="1-main-window">1. Main window</h4>
    <ul>
      <li>Options panel &gt;&gt;
        <ul>
          <li>
            <b><i>Apply logical masks</i></b>: Click to use logical masks from the <i>Imaging Reference Files</i> of each recording to hide unwanted regions. A dialog window will open prior to the averaging of the data to select the Imaging reference <samp>.mat</samp> file.
            <div class="warnnote">
              <p><strong>Important</strong><br>
                This tool will look for the logical masks in the <i>Imaging Reference Files</i> located in the subject folder. In order to make this work, all subject folders must contain an Imaging Reference <samp>.mat</samp> file with an existing logical mask. The <samp>.mat</samp> file must have the same name in all folders.
              </p>
            </div>
          </li>          
          <li><b><i>Spatial Filter sigma</i></b>: Standard deviation value for a spatial gaussian filter applied to the averaged data. If <b>zero</b>, no filter is applied</li>
          <li><b><i>Set colormap</i></b>: Sets the colormap and scale of the plots</li>
          <li>color scale &gt;&gt;
            <ul>
              <li><b><i>Auto</i></b>: The colormap is scaled for each <i>Image window</i>. This means that the colormap limits correspond to the <b>min</b> and <b>max</b> values of the observation (<b>data from all groups included!</b>)</li>
              <li><b><i>Uniform</i></b>: One scale is applied to all <i>Image windows</i>. If this option is used, the color scale limits can be manually set in the <i>Set colormap</i> option</li>
            </ul>
          </li>
          <li><b><i>Create Maps</i></b> button: Click here to calculate the average maps and plot the data</li>
          <li><b><i>Export</i></b> button: exports the figures to an image file (.PNG, .JPEG or .TIFF)</li>
        </ul>
      </li>
    </ul>

    <h4 id="2-image-window">2. Image window</h4>
    <p> One figure (image window) is created for each observation contained in the input data. A montage of the average maps is shown for each group where the maps are displayed in chronological order (from left to right). A montage is created for each experimental group.
    </p>
    <h3 id="examples">Examples</h3>
    <hr>
    <h4> Plot group resting state average maps</h4>
    <p>
      In this example, we show how to plot the average seed-pixel correlation maps of four mice for a subset of two ROIs (i.e. observations) as seed (see image below). The input data was generated using the <a href="../fcns/genCorrelationMatrix.html">genCorrelationMatrix</a> function.
    </p>
    <p style="text-align: center;">
      <img src="../../assets/img/PlotAvgMaps_ex1_fig1.png" alt="PlotAvgMaps_ex1_fig1" width="660"><br>
      <i>The data from four resting state acquisitions from four mice is selected. The left and right primary visual areas (V1) will be visualized</i>
    </p>
    <p>
      How to create average maps:
    </p>
    <p style="text-align: center;">
      <video src="../../assets/gifs/PlotAvgMaps_example1.webm" alt="PlotAvgMaps_example1", width="880" controls></video>
    </p>
    <div class="infonote">
      <p><strong>Note</strong><br>
        Note that when using logical masks, an extra figure is created showing the overlay of all individual masks used. 
      </p>
    </div>
    <p>
      In the example below, we show the average maps of two experimental groups (M4s and M5s) with data of five events across four acquisitions:
    </p>
    <p style="text-align: center;">
      <img src="../../assets/img/PlotAvgMaps_ex2_fig1.png" alt="PlotAvgMaps_ex2_fig1" width="660"><br>
      <i>The data from four event-triggered response acquisitions from two groups of two mice each.</i>
    </p>
    <p>
      How to create average maps:
    </p>
    <p style="text-align: center;">
      <video src="../../assets/gifs/PlotAvgMaps_example2.webm" alt="PlotAvgMaps_example2" width="880" controls></video>
    </p>
    <br>
    <hr>
  </body>
</html>
